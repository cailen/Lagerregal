{% extends "base.html" %}
{% load devicetags %}
{% load i18n %}

{% block title %}{{ actionstring }} {% if object != None %}{{ object }}{% else %}Object{% endif %}{% endblock %}

{% block content %}
    <div class="col-xs-12 col-md-6 offset-md-{% if formhelp %}1{% else %}3{% endif %} card p-4 bg-light">
        {% if form.non_field_errors %}
            <div class="alert alert-danger">
                {{ form.non_field_errors }}
            </div>
        {% endif %}
        <form action="" method="post" enctype="{{ enctype|default:'application/x-www-form-urlencoded' }}">{% csrf_token %}
            {% for field in form.visible_fields %}
                <div class="form-group {{ field.css_classes }} row">
                    <label for="{{ field.html_name }}" class="col-lg-3 col-form-label">
                        {{ field.label }}{% if field.field.required %}*{% endif %}</label>

                    <div class="col-lg-9">
                        {% if field|is_select or field|is_selectmultiple %}{{ field }}{% else %}
                            {{ field|add_class:'form-control' }}{% endif %}
                        <p class="form-text">
                            {% if field.errors %}{% for error in field.errors %}{{ error }}, {% endfor %}{% endif %}</p>
                    </div>
                </div>
            {% endfor %}
            {% for field in form.hidden_fields %}
                 <div style="display:none;">{{ field }}</div>
            {% endfor %}
            <input type="submit" value="{% trans 'Submit' %}" class="btn btn-success float-right"/>
        </form>
    </div>
    {% if formhelp %}
        <div class="col-xs-12 col-md-4 offset-md-1 card p-4">
            <h3 class="mt-0">{% trans "Help" %}</h3>
            {% include formhelp %}
        </div>
    {% endif %}
{% endblock %}

{% block scriptend %}
    $( "input:text[name=name]" ).keyup(function() {
    if($(this).val().length > 1) {
    $.ajax({
    type: "POST",
    url: "{% url "autocomplete-name" %}",
    data: {'classtype':'{{ type }}', 'name':$(this).val()}
    }).done(function(data){
    if (data != "") {
    if ($("#alternatives").length == 0){
    $( "input:text[name=name]" ).after("<div class='alert-danger alert' id='alternativebox'>There seem to be objects with similar name. Do you maybe mean one of those?<ul id='alternatives' style='margin-top:10px;' class='list-unstyled'></ul></div>")
    }
    $("#alternatives").empty()
    for (var i=0; i < data.length; i++) {
    $("#alternatives").append(data[i])
    };
    } else {
    $("#alternativebox").remove();
    }


    });
    }
    });

    $(function() {
    $( "#id_duedate" ).datepicker();
    });
    $( "input:text[name=smalldevice]" ).autocomplete({
    minLength: 2,
    source: function( request, response ) {
    var term = request.term;
    $.ajax({
    type: "POST",
    url: "{% url "autocomplete-smalldevice" %}",
    data: {'name':term}
    }).done(response);
    }
    });
    {% autoescape off %}{{ form_scripts }}{% endautoescape %}
    $("select").select2();
{% endblock %}
